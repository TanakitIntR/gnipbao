var Car=function(e,a,c,d,b){this.m=m;this.ind=c;this.cv=e;this.xo=this.m.xo;this.yo=this.m.yo;this.rad=3;this.hex=a;this.route=b;this.routeNum=this.route.ind;this.isDead=false;this.pt0=new Point();this.pt1=new Point();this.spdGrab=4;this.isFw=d;this.isFirstRun=true;this.indThr=this.indThrStart=this.isFw?0:this.route.arrThreads.length-1;this.placeOnThread(this.route.arrThreads[this.indThrStart]);};Car.prototype.redraw=function(){this.xo=this.m.xo;this.yo=this.m.yo;this.cv.beginPath();this.cv.fillStyle=this.hex;this.cv.arc(this.xp1+this.xo,this.yp1+this.yo,this.rad,0,Math.PI*2,false);this.cv.closePath();this.cv.fill();};Car.prototype.placeOnThread=function(a){if(a.ind==this.indThrStart){this.m.carCt++;this.spdBase=0.005;this.pxPerSec=a.route.pxPerSec;}this.thread=a;a.carStart(this);this.ang=this.isFw?this.thread.angOrig:this.thread.angOrig+Math.PI;this.xpo0=this.xp0=this.xp1=this.isFw?this.thread.xpo0:this.thread.xpo1;this.ypo0=this.yp0=this.yp1=this.isFw?this.thread.ypo0:this.thread.ypo1;this.cosAng=Math.cos(this.ang);this.sinAng=Math.sin(this.ang);};Car.prototype.upd=function(){var g=this.pxPerSec*this.m.ff;this.spd=g;this.dx=this.cosAng*g;this.dy=this.sinAng*g;var b=this.xp0+this.dx;var e=this.yp0+this.dy;var f=b-this.xpo0;var a=e-this.ypo0;this.distThr=Math.sqrt(f*f+a*a);this.thrRat=this.distThr/this.thread.lenOrig;if(this.thrRat>1){if((this.isFw&&(this.indThr>=this.route.arrThreads.length-1))||(!this.isFw&&(this.indThr<=0))){if(!this.isDead){this.endOfRoute();}return;}else{if(this.isFw){this.indThr++;}else{this.indThr--;}this.thread.carDone(this);this.placeOnThread(this.route.arrThreads[this.indThr]);return;}}else{this.xp1=b;this.yp1=e;this.pt0.x=this.xp0;this.pt0.y=this.yp0;this.pt1.x=this.xp1;this.pt1.y=this.yp1;this.xp0=this.xp1;this.yp0=this.yp1;this.thread.carMoved();}if(this.isFirstRun){this.isFirstRun=false;return;}for(var c=0;c<this.thread.arrIntersect.length;c++){th=this.thread.arrIntersect[c];if((!th.route.isOn)||(!th.isVisible)||(th.route.isExiting)||(th.len<this.thLenIgnore)||isNaN(th.len)){continue;}var d=lineIntersect(this.pt0,this.pt1,th.pt0,th.pt1);if(d==null){continue;}xi=d.x;yi=d.y;if((!th.isGrabbed)&&(!isNaN(xi))&&(!isNaN(yi))){if(this.spd>this.spdGrab){this.m.pluckThread(th,xi,yi,false,this);}else{this.m.grabThread(th,xi,yi,false,this);}}}};Car.prototype.endOfRoute=function(){this.isDead=true;if(this.thrGrab!=null){this.thrGrab.drop();}this.route.carAtEnd();};Car.prototype.getX=function(){return this.xp1;};Car.prototype.getY=function(){return this.yp1;};