var Route=function(d,a,c,b,f,e){this.m=m;this.ind=d;this.hex=b;this.tDurMin=f;this.tDurSec=this.tDurMin*60;this.hexCurr=this.hex;this.col=hex2rgb(this.hex);this.idColor=a;this.idName=c;this.arrPos=e;this.arrCars=new Array();this.ctCars=0;this.arrThreads=new Array();this.t1;this.tAlive0=4.5;this.tAlive1=2.5;this.tAlive=this.tAlive0;this.tFade0=18;this.tFade1=7;this.tFade=this.tFade0;this.len=0;this.isMidDraw=this.isExiting=false;};Route.prototype.init=function(){this.pxPerSec=this.len/this.tDurSec;};Route.prototype.upd=function(){if(!this.isOn){return;}this.t1=(new Date()).getTime()/1000;if(this.isExiting){this.updExit();}else{if(this.isMidDraw){}else{var c=this.t1-this.tLinger0;if((c>this.tAlive)&&(this.m.rtVis>this.m.rtVisMin)){this.startExit();}}}for(var a=0;a<this.arrThreads.length;a++){this.arrThreads[a].upd();}var b;for(var a=0;a<this.arrCars.length;a++){b=this.arrCars[a];b.redraw();b.upd();}};Route.prototype.updExit=function(){var c=this.t1-this.tExit;if(c>=this.tFade){this.exitDone();}else{var b=0.71;var a=0.2;if(c<a){var d=c/a*b;}else{var d=b+(1-b)*(c-a)/(this.tFade-a);}this.colCurr=lerpColor(this.col,this.m.colBg,d);this.hexCurr=getColor(this.colCurr);}};Route.prototype.addThread=function(a){this.arrThreads.push(a);};Route.prototype.addCar=function(a){var b=new Car(this.m.cv1,this.hex,this.ctCars,a,this);this.ctCars++;this.arrCars.push(b);};Route.prototype.startEnter=function(b){for(var a=0;a<this.arrThreads.length;a++){this.arrThreads[a].routeStartEnter();}this.isOn=true;this.isMidDraw=true;this.hexCurr=this.hex;this.m.rtVis++;this.addCar(b);};Route.prototype.startExit=function(){this.tFade=lerp(this.tFade0,this.tFade1,this.m.ffRat);this.tExit=(new Date()).getTime()/1000;this.isExiting=true;for(var a=0;a<this.arrThreads.length;a++){if(this.arrThreads[a].carGrab!=null){this.arrThreads[a].drop();}}this.m.rtVis--;};Route.prototype.exitDone=function(){this.isExiting=false;this.isOn=false;};Route.prototype.carAtEnd=function(){this.arrCars.shift();this.isMidDraw=false;this.tLinger0=(new Date()).getTime()/1000;this.tAlive=lerp(this.tAlive0,this.tAlive1,this.m.ffRat);};Route.prototype.addToLength=function(a){this.len+=a;};